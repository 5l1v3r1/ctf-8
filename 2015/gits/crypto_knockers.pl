#!/usr/bin/perl

use strict;

use constant {
    HASH_HEX_SIZE => 128,
    PORT => 7175,
    TOKEN => '6e248dc3dec420c42f48f720475f9cb70f2485d8214715c66106050fd1a7b687326b2c82114419474042bb5df1602d578c059ba5dac260f644b8584dd5a0a38b0050' 
};

my $token = gen_new_token(sprintf('0x%04x', PORT), TOKEN);

print $token;

sub gen_new_token {
    my ($append, $token) = @_;
    my $sig = substr($token, 0,HASH_HEX_SIZE);
    my $data = sprintf("0x%04x", hex('0x' . substr($token, HASH_HEX_SIZE)));

    my @output = `hash_extender -d $data --data-format hex -s $sig -a $append --append-format hex -f sha512 -l 16`;
    my $new_token;

    foreach my $l(@output) {
	$new_token .= $1 if($l =~ m/New signature: (\S+)/);
	$new_token .= $1 if($l =~ m/New string: (\S+)/);
    }

    return $new_token;
}    


    ############################################################################################################################################################################################################################################################################################################################################################################################################################################
    # $ perl crypto_knockers.pl																																																		       #
    # f11849ac29b10a169b8a378a84695ddf8d80c2e75f6e59e7de5a84a66e5c204efb1d3b2e486498d106b7236b7fbf23fefb7f3ce930c702c25ff5563bd596bea7005080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000901c07								       #
    # 																																																					       #
    # 																																																					       #
    # $ python2.7 knockers.py knock knockers.2015.ghostintheshellcode.com f11849ac29b10a169b8a378a84695ddf8d80c2e75f6e59e7de5a84a66e5c204efb1d3b2e486498d106b7236b7fbf23fefb7f3ce930c702c25ff5563bd596bea7005080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000901c07 #
    # 																																																					       #
    # 																																																					       #
    # $ wget knockers.2015.ghostintheshellcode.com:7175																																															       #
    # 																																																					       #
    # $ cat index.html | grep key																																																	       #
    # <a href="key.txt">key.txt</a>                                            16-Jan-2015 23:10                  39																																							       #
    # 																																																					       #
    # $ wget knockers.2015.ghostintheshellcode.com:7175/key.txt																																														       #
    # 																																																					       #
    # $ cat key.txt																																																			       #
    # the_snozberries_taste_like_snozberries																																																       #
    ############################################################################################################################################################################################################################################################################################################################################################################################################################################

    
